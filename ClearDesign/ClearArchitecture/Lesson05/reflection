Реализация похожа на то, что я делал для ООП варианта
